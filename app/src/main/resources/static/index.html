<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Banking Application</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      body {
        background-color: #ffffff;
        color: #1a124d;
        font-family: "Open Sans", Arial, Helvetica, sans-serif;
        font-size: 20px;
        line-height: 30px;
      }

      .navbar {
        background-color: #c6fff6;
      }

      .navbar-brand {
        font-family: Georgia, serif;
        color: #1a124d;
        font-size: 36px;
        font-weight: bold;
      }

      .nav-link {
        color: #1a124d;
        position: relative;
        text-decoration: none;
        font-weight: 700;
        font-size: 16px;
        padding-bottom: 5px;
        transition: color 0.3s;
      }

      .nav-link:hover {
        color: #1a124d;
      }

      .nav-link::after {
        content: "";
        display: block;
        height: 3px;
        width: 0;
        background: #007c4e;
        transition: width 0.4s ease;
        position: absolute;
        left: 0;
        bottom: -2px;
      }

      .nav-link:hover::after,
      .nav-link.active::after {
        width: 100%;
      }

      h1,
      h2 {
        color: #1a124d;
        margin-left: 20px;
        font-weight: 600;
      }

      .btn-custom {
        background-color: #1a124d;
        color: #ffffff;
        border-radius: 25px;
        transition: background-color 0.4s ease;
      }

      .btn-custom:hover {
        background-color: #afa5e0;
        color: #ffffff;
      }

      .section-header {
        background-color: #c6fff6;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 15px;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light">
      <a class="navbar-brand" href="#" onclick="showSection('main')">Banking</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showSection('accounts')"
              >Accounts</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showSection('transfer')"
              >Transfer Funds</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showSection('transactions')"
              >Transactions</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <div class="container mt-4" id="mainContent">
      <h1>Welcome to the Banking App</h1>
      <p>This is a web application for managing bank accounts.</p>
    </div>

    <div class="container mt-4 d-none" id="accountsListSection">
      <div class="section-header"><h2>Your Accounts</h2></div>
      <table class="table" id="accountTable">
        <thead>
          <tr>
            <th>Account Number</th>
            <th>Account Name</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody id="accountTableBody"></tbody>
      </table>
    </div>

    <div class="container mt-4 d-none" id="addAccountSection">
      <div class="section-header"><h2>Add Account</h2></div>
      <form onsubmit="event.preventDefault(); addAccount()">
        <div class="form-group">
          <label for="accountNameInput">Account Name:</label
          ><input
            type="text"
            id="accountNameInput"
            class="form-control"
            required
          />
        </div>
        <div class="form-group">
          <label for="initialBalanceInput">Initial Balance:</label
          ><input
            type="number"
            id="initialBalanceInput"
            class="form-control"
            required
          />
        </div>
        <button type="submit" class="btn btn-custom">Add Account</button>
      </form>
    </div>

    <div class="container mt-4 d-none" id="transferFundsSection">
      <div class="section-header"><h2>Transfer Funds</h2></div>
      <form onsubmit="event.preventDefault(); transferFunds()">
        <div class="form-group">
          <label for="fromAccountSelect">From Account:</label
          ><select
            id="fromAccountSelect"
            class="form-control"
            required
          ></select>
        </div>
        <div class="form-group">
          <label for="toAccountSelect">To Account:</label
          ><select id="toAccountSelect" class="form-control" required></select>
        </div>
        <div class="form-group">
          <label for="transferAmountInput">Amount:</label
          ><input
            type="number"
            id="transferAmountInput"
            class="form-control"
            required
          />
        </div>
        <button type="submit" class="btn btn-custom">Transfer</button>
      </form>
    </div>

    <div class="container mt-4 d-none" id="transactionHistorySection">
      <div class="section-header"><h2>Transaction History</h2></div>
      <table class="table" id="transactionTable">
        <thead>
          <tr>
            <th>Transaction ID</th>
            <th>From Account</th>
            <th>To Account</th>
            <th>Amount</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="transactionTableBody"></tbody>
      </table>
    </div>

    <script>
      let accounts = [];

      function clearActiveLinks() {
        document
          .querySelectorAll(".nav-link")
          .forEach((link) => link.classList.remove("active"));
      }

      function showSection(section) {
        clearActiveLinks();
        hideAllSections();
        switch (section) {
          case "main":
            document.getElementById("mainContent").classList.remove("d-none");
            break;
          case "accounts":
            document
              .getElementById("accountsListSection")
              .classList.remove("d-none");
            document
              .getElementById("addAccountSection")
              .classList.remove("d-none");
            getAccounts();
            break;
          case "transfer":
            document
              .getElementById("transferFundsSection")
              .classList.remove("d-none");
            populateAccountSelects();
            break;
          case "transactions":
            document
              .getElementById("transactionHistorySection")
              .classList.remove("d-none");
            getTransactions();
            break;
        }
        document
          .querySelector(`.nav-link[href='#'][onclick*='${section}']`)
          .classList.add("active");
      }

      function hideAllSections() {
        [
          "mainContent",
          "accountsListSection",
          "addAccountSection",
          "transferFundsSection",
          "transactionHistorySection",
        ].forEach((id) => {
          document.getElementById(id).classList.add("d-none");
        });
      }

      function getAccounts() {
        fetch("/api/v1/accounts")
          .then((response) => response.json())
          .then((data) => {
            accounts = data;
            const tableBody = document.getElementById("accountTableBody");
            tableBody.innerHTML =
              accounts.length === 0
                ? '<tr><td colspan="3" align="center">No accounts available</td></tr>'
                : accounts
                    .map(
                      (account) =>
                        `<tr><td>${account.id}</td><td>${account.name}</td><td>${account.balance}</td></tr>`
                    )
                    .join("");
          })
          .catch((error) => console.error("Error:", error));
      }

      function populateAccountSelects() {
        const selectElements = [
          document.getElementById("fromAccountSelect"),
          document.getElementById("toAccountSelect"),
        ];
        selectElements.forEach((select) => {
          select.innerHTML = accounts
            .map(
              (account) =>
                `<option value="${account.id}">${account.id} - ${account.name}</option>`
            )
            .join("");
        });
      }

      function addAccount() {
        const account = {
          name: document.getElementById("accountNameInput").value,
          balance: parseFloat(
            document.getElementById("initialBalanceInput").value
          ),
        };

        fetch("/api/v1/account", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(account),
        })
          .then((response) =>
            response.ok ? response.json() : Promise.reject()
          )
          .then((newAccount) => {
            resetForms();
            getAccounts();
          })
          .catch((error) => console.error("Error:", error));
      }

      function transferFunds() {
        const transferData = {
          fromAccountId: document.getElementById("fromAccountSelect").value,
          toAccountId: document.getElementById("toAccountSelect").value,
          amount: parseFloat(
            document.getElementById("transferAmountInput").value
          ),
        };

        fetch("/api/v1/transfer", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(transferData),
        })
          .then(() => {
            resetForms();
            getTransactions();
          })
          .catch((error) => console.error("Error:", error));
      }

      function getTransactions() {
        fetch("/api/v1/transactions")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((transactions) => {
            if (!Array.isArray(transactions)) {
              throw new Error("Expected transactions to be an array");
            }

            const tableBody = document.getElementById("transactionTableBody");
            tableBody.innerHTML =
              transactions.length === 0
                ? '<tr><td colspan="5" align="center">No transactions available</td></tr>'
                : transactions
                    .map(
                      (transaction) => `
                    <tr>
                        <td>${transaction.id}</td>
                        <td>${transaction.fromAccountName}</td>
                        <td>${transaction.toAccountName}</td>
                        <td>${transaction.amount}</td>
                        <td>${new Date(transaction.date).toLocaleString()}</td>
                    </tr>
                `
                    )
                    .join("");
          })
          .catch((error) => console.error("Error:", error));
      }

      function resetForms() {
        document.getElementById("accountNameInput").value = "";
        document.getElementById("initialBalanceInput").value = "";
        document.getElementById("fromAccountSelect").selectedIndex = 0;
        document.getElementById("toAccountSelect").selectedIndex = 0;
        document.getElementById("transferAmountInput").value = "";
      }
    </script>
  </body>
</html>
